// jquery.dynatree.js build 0.3.0_rc2_20081122
// Revision: 91, date: 2008-11-16 15:49:53
// Copyright (c) 2008  Martin Wendt (http://dynatree.googlecode.com/)
// Licensed under the MIT License.


var Class={create:function(){return function(){this.initialize.apply(this,arguments);}}}
var _bDebug=false;_bDebug=true;function logMsg(msg){if(_bDebug&&window.console&&window.console.log){var dt=new Date();var tag=dt.getHours()+':'+dt.getMinutes()+':'+dt.getSeconds()+'.'+dt.getMilliseconds();arguments[0]=tag+" - "+arguments[0];try{window.console.log.apply(this,arguments);}catch(e){}}}
var DTNodeStatus_Error=-1;var DTNodeStatus_Loading=1;var DTNodeStatus_Ok=0;var DynaTreeNode=Class.create();DynaTreeNode.prototype={initialize:function(tree,data){this.tree=tree;if(typeof data=='string'){this.data={title:data};}else{this.data=jQuery.extend({},jQuery.ui.dynatree.nodedatadefaults,data);}
this.parent=null;this.div=null;this.span=null;this.aChilds=null;this.bRead=false;this.bExpanded=(data.expand==true)?true:false;if(this.tree.initCookie&&this.bExpanded){this.tree._changeExpandList(this.data.key,true,false);}else if(this.tree.options.persist&&!this.tree.initCookie&&this.data.key){this.bExpanded=(jQuery.inArray(this.data.key,this.tree.expandedKeys)>=0);}},toString:function(){return"DynaTreeNode '"+this.data.title+"', key="+this.data.key;},getInnerHtml:function(){var res='';var bIsRoot=(this.parent==null);var bHideFirstConnector=(!this.tree.options.rootVisible||!this.tree.options.rootCollapsible);var p=this.parent;var cache=this.tree.cache;while(p){if(!(bHideFirstConnector&&p.parent==null))
res=(p.isLastSibling()?cache.tagL_:cache.tagL_ns)+res;p=p.parent;}
if(bHideFirstConnector&&bIsRoot){}else if(this.aChilds&&this.bExpanded){res+=(this.isLastSibling()?cache.tagM_ne:cache.tagM_nes);}else if(this.aChilds){res+=(this.isLastSibling()?cache.tagP_ne:cache.tagP_nes);}else if(this.data.isLazy){res+=(this.isLastSibling()?cache.tagD_ne:cache.tagD_nes);}else{res+=(this.isLastSibling()?cache.tagL_ne:cache.tagL_nes);}
if(this.data&&this.data.icon){res+='<img src="'+this.tree.options.imagePath+this.data.icon+'" alt="" />';}else if(this.data&&this.data.icon==false){}else if(this.data.isFolder){res+=(this.bExpanded?cache.tagFld_o:cache.tagFld);}else{res+=cache.tagDoc;}
var tooltip=(this.data&&typeof this.data.tooltip=='string')?' title="'+this.data.tooltip+'"':'';res+='<a href="#" '+tooltip+'>'+this.data.title+'</a>';return res;},render:function(bDeep,bHidden){if(!this.div){this.div=document.createElement('div');this.span=document.createElement('span');this.span.dtnode=this;if(this.data.key)
this.span.id=this.tree.options.idPrefix+this.data.key;this.span.className=(this.data.isFolder)?this.tree.options.classnames.folder:this.tree.options.classnames.document;this.div.appendChild(this.span);if(this.parent)
this.parent.div.appendChild(this.div);}
if(this.parent==null)
this.span.style.display=(this.tree.options.rootVisible?'':'none');this.div.style.display=(this.parent==null||this.parent.bExpanded?'':'none');this.span.innerHTML=this.getInnerHtml();if(bDeep&&this.aChilds&&(bHidden||this.bExpanded)){for(var i=0;i<this.aChilds.length;i++){this.aChilds[i].render(bDeep,bHidden)}}},isLastSibling:function(){var p=this.parent;if(!p)return true;return p.aChilds[p.aChilds.length-1]===this;},prevSibling:function(){if(!this.parent)return null;var ac=this.parent.aChilds;for(var i=1;i<ac.length;i++)
if(ac[i]===this)
return ac[i-1];return null;},nextSibling:function(){if(!this.parent)return null;var ac=this.parent.aChilds;for(var i=0;i<ac.length-1;i++)
if(ac[i]===this)
return ac[i+1];return null;},_setStatusNode:function(data){var firstChild=(this.aChilds?this.aChilds[0]:null);if(!data){if(firstChild){this.div.removeChild(firstChild.div);if(this.aChilds.length==1)
this.aChilds=null;else
this.aChilds.shift();}}else if(firstChild){firstChild.data=data;firstChild.render(false,false);}else{firstChild=this._addChildNode(new DynaTreeNode(this.tree,data));firstChild.data.isStatusNode=true;}},setLazyNodeStatus:function(lts){switch(lts){case DTNodeStatus_Ok:this._setStatusNode(null);this.bRead=true;if(this===this.tree.tnRoot&&this.tree.options.focusRoot&&!this.tree.options.rootVisible&&this.aChilds){this.aChilds[0].focus();}else{this.focus();}
break;case DTNodeStatus_Loading:this._setStatusNode({title:this.tree.options.strings.loading,icon:"ltWait.gif"});break;case DTNodeStatus_Error:this._setStatusNode({title:this.tree.options.strings.loadError,icon:"ltError.gif"});break;default:throw"Bad LazyNodeStatus: '"+lts+"'.";}},_parentList:function(includeRoot,includeSelf){var l=new Array();var dtn=includeSelf?this:this.parent;while(dtn){if(includeRoot||dtn.parent)
l.unshift(dtn);dtn=dtn.parent;};return l;},isVisible:function(){var parents=this._parentList(true,false);for(var i=0;i<parents.length;i++)
if(!parents[i].bExpanded)return false;return true;},makeVisible:function(){var parents=this._parentList(true,false);for(var i=0;i<parents.length;i++)
parents[i]._expand(true);},focus:function(){this.makeVisible();try{$(this.span).find(">a").focus();}catch(e){}},select:function(){if(this.tree.isDisabled||this.data.isStatusNode)
return;if(this.tree.tnSelected){if(this.tree.tnSelected===this)
return;this.tree.tnSelected.unselect();}
if(this.tree.options.selectionVisible)
this.makeVisible();this.tree.tnSelected=this;$(this.span).addClass(this.tree.options.classnames.selected);if(this.tree.options.onSelect)
this.tree.options.onSelect.call(this.span,this);},unselect:function(){$(this.span).removeClass(this.tree.options.classnames.selected);if(this.tree.tnSelected===this){this.tree.tnSelected=null;if(this.tree.options.onUnselect)
this.tree.options.onUnselect.call(this.span,this);}},_expand:function(bExpand){if(this.bExpanded==bExpand)
return;this.bExpanded=bExpand;if(this.tree.options.persist&&this.data.key){this.tree._changeExpandList(this.data.key,bExpand,true);}
if(this.bExpanded&&this.parent&&this.tree.options.autoCollapse){var parents=this._parentList(false,true);for(var i=0;i<parents.length;i++)
parents[i].collapseSiblings();}
if(!this.bExpanded&&!this.isVisible()){logMsg("Focus became invisible: setting to this.");this.focus();}
if(this.tree.options.selectionVisible&&this.tree.tnSelected&&!this.tree.tnSelected.isVisible()){this.tree.tnSelected.unselect();}
if(bExpand&&this.data.isLazy&&!this.bRead){try{this.setLazyNodeStatus(DTNodeStatus_Loading);if(true==this.tree.options.onLazyRead.call(this.span,this)){this.setLazyNodeStatus(DTNodeStatus_Ok);}}catch(e){this.setLazyNodeStatus(DTNodeStatus_Error);}
return;}
this.render(true,false);if(this.aChilds){for(var i=0;i<this.aChilds.length;i++){this.aChilds[i].div.style.display=(this.bExpanded?'':'none');}}},toggleExpand:function(){logMsg('toggleExpand('+this.data.title+')...');this._expand(!this.bExpanded);logMsg('toggleExpand('+this.data.title+') done.');},collapseSiblings:function(){if(this.parent==null)
return;var ac=this.parent.aChilds;for(var i=0;i<ac.length;i++){if(ac[i]!==this&&ac[i].bExpanded)
ac[i]._expand(false);}},onDblClick:function(event){if(this.data.isFolder&&(this.aChilds||this.data.isLazy)&&(this.parent!=null||this.tree.options.rootCollapsible)){this.toggleExpand();}},_activate:function(){if(this.data.isFolder&&this.tree.options.selectExpandsFolders&&(this.parent!=null||this.tree.options.rootCollapsible)){this.toggleExpand();this.focus();}else{this.select();}},onClick:function(event){if($(event.target).hasClass(this.tree.options.classnames.expander)){this.toggleExpand();}else{this._activate();}
this.focus();return false;},onKeypress:function(event){var code=(!event.charCode)?1000+event.keyCode:event.charCode;var handled=true;switch(code){case 43:if(!this.bExpanded)this.toggleExpand();break;case 45:if(this.bExpanded)this.toggleExpand();break;case 1032:case 32:this._activate();break;case 1008:if(this.parent)
this.parent.focus();break;case 1037:if(this.bExpanded){this.toggleExpand();this.focus();}else if(this.parent&&(this.tree.options.rootVisible||this.parent.parent)){this.parent.focus();}
break;case 1039:if(!this.bExpanded&&(this.aChilds||this.data.isLazy)){this.toggleExpand();this.focus();}else if(this.aChilds){this.aChilds[0].focus();}
break;case 1038:var sib=this.prevSibling();while(sib&&sib.bExpanded)
sib=sib.aChilds[sib.aChilds.length-1];if(!sib&&this.parent&&(this.tree.options.rootVisible||this.parent.parent))
sib=this.parent;if(sib)sib.focus();break;case 1040:var sib;if(this.bExpanded){sib=this.aChilds[0];}else{var parents=this._parentList(false,true);for(var i=parents.length-1;i>=0;i--){sib=parents[i].nextSibling();if(sib)break;}}
if(sib)sib.focus();break;default:handled=false;}
if(handled)
return false;},onFocus:function(event){if(event.type=="blur"||event.type=="focusout"){if(this.tree.options.onBlur)
this.tree.options.onBlur.call(this.span,this);if(this.tree.tnFocused)
$(this.tree.tnFocused.span).removeClass(this.tree.options.classnames.focused);this.tree.tnFocused=null;}else if(event.type=="focus"||event.type=="focusin"){if(this.tree.tnFocused&&this.tree.tnFocused!==this){logMsg("dtnode.onFocus: out of sync: curFocus: %o",this.tree.tnFocused);$(this.tree.tnFocused.span).removeClass(this.tree.options.classnames.focused);}
this.tree.tnFocused=this;if(this.tree.options.onFocus)
this.tree.options.onFocus.call(this.span,this);$(this.tree.tnFocused.span).addClass(this.tree.options.classnames.focused);}},remove:function(){logMsg('%o.remove()',this);if(this===this.tree.root)
return false;return this.parent.removeChild(this);},removeChild:function(tn){var ac=this.aChilds;if(ac.length==1){if(tn!==ac[0])
throw"removeChild: invalid child";return this.removeChildren();}
if(tn===this.tree.tnSelected)
tn.unselect();tn.removeChildren(true);this.div.removeChild(tn.div);for(var i=0;i<ac.length;i++){if(ac[i]===tn){this.aChilds.splice(i,1);delete tn;break;}}},removeChildren:function(recursive){var tree=this.tree;var ac=this.aChilds;if(ac){for(var i=0;i<ac.length;i++){var tn=ac[i];if(tn===tree.tnSelected)
tn.unselect();tn.removeChildren(true);this.div.removeChild(tn.div);delete tn;}
this.aChilds=null;if(!recursive){this._expand(false);this.bRead=false;this.render(false,false);}}},_addChildNode:function(dtnode){if(this.aChilds==null)
this.aChilds=new Array();this.aChilds.push(dtnode);dtnode.parent=this;if(this.tree.options.expandOnAdd||((!this.tree.options.rootCollapsible||!this.tree.options.rootVisible)&&this.parent==null)){this.bExpanded=true;if(this.tree.initCookie)
this.tree._changeExpandList(this.key,true,false);}
if(this.tree.bEnableUpdate)
this.render(true,true);return dtnode;},_addNode:function(data){var dtnode=new DynaTreeNode(this.tree,data);return this._addChildNode(dtnode);},append:function(obj){if(!obj||obj.length==0)
return;if(!obj.length)
return this._addNode(obj);var prevFlag=this.tree.enableUpdate(false);var tnFirst=null;for(var i=0;i<obj.length;i++){var data=obj[i];var dtnode=this._addNode(data);if(!tnFirst)tnFirst=dtnode;if(data.children)
dtnode.append(data.children);}
this.tree.enableUpdate(prevFlag);return tnFirst;},appendAjax:function(ajaxOptions){this.setLazyNodeStatus(DTNodeStatus_Loading);var self=this;var ajaxOptions=jQuery.extend({},this.tree.options.ajaxDefaults,ajaxOptions,{success:function(data,textStatus){self.append(data);self.setLazyNodeStatus(DTNodeStatus_Ok);},error:function(XMLHttpRequest,textStatus,errorThrown){self.setLazyNodeStatus(DTNodeStatus_Error);}});jQuery.ajax(ajaxOptions);},lastentry:undefined}
var DynaTree=Class.create();DynaTree.prototype={initialize:function(id,options){logMsg("DynaTree.initialize()");this.options=options;this.tnSelected=null;this.bEnableUpdate=true;this.isDisabled=false;this.expandedKeys=new Array();this.initCookie=false;if(this.options.persist){var cookie=jQuery.cookie(this.options.cookieId);if(cookie){this.expandedKeys=cookie.split(",");}else{this.initCookie=true;}
logMsg("Read cookie: %o, initCookie: %o",this.expandedKeys,this.initCookie);}
this.cache={tagFld:"<img src='"+options.imagePath+"ltFld.gif' alt='' />",tagFld_o:"<img src='"+options.imagePath+"ltFld_o.gif' alt='' />",tagDoc:"<img src='"+options.imagePath+"ltDoc.gif' alt='' />",tagL_ns:"<img src='"+options.imagePath+"ltL_ns.gif' alt=' | ' />",tagL_:"<img src='"+options.imagePath+"ltL_.gif' alt='   ' />",tagL_ne:"<img src='"+options.imagePath+"ltL_ne.gif' alt=' + ' />",tagL_nes:"<img src='"+options.imagePath+"ltL_nes.gif' alt=' + ' />",tagM_ne:"<img src='"+options.imagePath+"ltM_ne.gif' alt='[-]' class='"+options.classnames.expander+"'/>",tagM_nes:"<img src='"+options.imagePath+"ltM_nes.gif' alt='[-]' class='"+options.classnames.expander+"'/>",tagP_ne:"<img src='"+options.imagePath+"ltP_ne.gif' alt='[+]' class='"+options.classnames.expander+"'/>",tagP_nes:"<img src='"+options.imagePath+"ltP_nes.gif' alt='[+]' class='"+options.classnames.expander+"'/>",tagD_ne:"<img src='"+options.imagePath+"ltD_ne.gif' alt='[?]' class='"+options.classnames.expander+"'/>",tagD_nes:"<img src='"+options.imagePath+"ltD_nes.gif' alt='[?]' class='"+options.classnames.expander+"'/>"};this.divTree=document.getElementById(id);this.tnRoot=new DynaTreeNode(this,{title:this.options.title,key:this.options.idPrefix+"root"});this.tnRoot.data.isFolder=true;this.tnRoot.render(false,false);this.divRoot=this.tnRoot.div;this.divRoot.className=this.options.classnames.container;this.divTree.appendChild(this.divRoot);},toString:function(){return"DynaTree '"+this.options.title+"'";},_changeExpandList:function(key,bAdd,bWriteCookie){if(!key)
return false;var n=this.expandedKeys.length;if(bAdd){if(jQuery.inArray(key,this.expandedKeys)==-1)
this.expandedKeys.push(key);}else{this.expandedKeys=jQuery.grep(this.expandedKeys,function(e){return(e!=key);});}
if(bWriteCookie){logMsg("_changeExpandList: write cookie: <%s> = '%s'",this.options.cookieId,this.expandedKeys.join(","));jQuery.cookie(this.options.cookieId,this.expandedKeys.join(","));}else{logMsg("_changeExpandList: %o",this.expandedKeys);}
return(n!=this.expandedKeys.length);},redraw:function(){logMsg("dynatree.redraw()...");this.tnRoot.render(true,true);logMsg("dynatree.redraw() done.");},getRoot:function(){return this.tnRoot;},getNodeByKey:function(key){var el=document.getElementById(this.options.idPrefix+key);return(el&&el.dtnode)?el.dtnode:null;},getSelectedNode:function(){return this.tnSelected;},selectKey:function(key){var dtnode=this.getNodeByKey(key);if(!dtnode){this.tnSelected=null;return null;}
dtnode.focus();dtnode.select();return dtnode;},enableUpdate:function(bEnable){if(this.bEnableUpdate==bEnable)
return bEnable;this.bEnableUpdate=bEnable;if(bEnable)
this.redraw();return!bEnable;},lastentry:undefined};(function($){function _getNodeFromElement(el){var iMax=4;do{if(el.dtnode)return el.dtnode;el=el.parentNode;}while(iMax--);return null;}
function fnClick(event){var dtnode=_getNodeFromElement(event.target);if(!dtnode)
return false;return dtnode.onClick(event);}
function fnDblClick(event){var dtnode=_getNodeFromElement(event.target);if(!dtnode)
return false;return dtnode.onDblClick(event);}
function fnKeyHandler(event){var dtnode=_getNodeFromElement(event.target);if(!dtnode)
return false;if(event.type=="keypress"&&event.charCode==0)
return;return dtnode.onKeypress(event);}
function fnFocusHandler(event){event=arguments[0]=$.event.fix(event||window.event);var dtnode=_getNodeFromElement(event.target);if(!dtnode)
return false;return dtnode.onFocus(event);}
$.widget("ui.dynatree",{init:function(){logMsg("ui.dynatree.init() was called, you should upgrade to ui.core.js v1.6 or higher.");return this._init();},_init:function(){this.options.event+='.dynatree';var $this=this.element;var opts=this.options;if(!opts.imagePath){$("script").each(function(){if(this.src.search(/.*dynatree[^/]*\.js$/i)>=0){if(this.src.indexOf("/")>=0)
opts.imagePath=this.src.slice(0,this.src.lastIndexOf("/"))+"/themes/";else
opts.imagePath="themes/";logMsg("Guessing imagePath from '%s': '%s'",this.src,opts.imagePath);return false;}});}
var id=$this.attr("id");this.tree=new DynaTree(id,opts);var root=this.tree.getRoot()
if(opts.children){root.append(opts.children);}else if(opts.initAjax&&opts.initAjax.url){root.appendAjax(opts.initAjax);}else if(opts.initId){this.createFromTag(root,$("#"+opts.initId));}else{var $ul=$this.find(">ul").hide();this.createFromTag(root,$ul);$ul.remove();}
$this.bind("click",fnClick);$this.bind("dblclick",fnDblClick);if(opts.keyboard){$this.bind("keypress keydown",fnKeyHandler);var div=this.tree.divTree;if(div.addEventListener){div.addEventListener("focus",fnFocusHandler,true);div.addEventListener("blur",fnFocusHandler,true);}else{div.onfocusin=div.onfocusout=fnFocusHandler;}
if(opts.focusRoot){if(opts.rootVisible){root.focus();}else if(root.aChilds&&!(opts.initAjax&&opts.initAjax.url)){root.aChilds[0].focus();}}}
if(this.tree.initCookie){logMsg("Write cookie: <%s> = '%s'",opts.cookieId,this.tree.expandedKeys.join(","));$.cookie(opts.cookieId,this.tree.expandedKeys.join(","));}},getTree:function(){return this.tree;},getRoot:function(){return this.tree.getRoot();},getSelectedNode:function(){return this.tree.getSelectedNode();},createFromTag:function(parentTreeNode,$ulParent){var self=this;$ulParent.find(">li").each(function(){var $li=$(this);var $liSpan=$li.find(">span:first");var title;if($liSpan.length){title=$liSpan.html();}else{title=$.trim($li.html().match(/.*(<ul)?/)[0]);}
var data={title:title,key:$li.attr("id"),isFolder:$li.hasClass("folder"),isLazy:$li.hasClass("lazy")};var dataAttr=$.trim($li.attr("data"));if(dataAttr){if(dataAttr.charAt(0)!="{")
dataAttr="{"+dataAttr+"}"
try{$.extend(data,eval("("+dataAttr+")"));}catch(e){throw("Error parsing node data: "+e+"\ndata:\n'"+dataAttr+"'");}}
childNode=parentTreeNode._addNode(data);var $ul=$li.find(">ul:first");if($ul.length){self.createFromTag(childNode,$ul);}});},lastentry:undefined});$.ui.dynatree.getter="getTree getRoot getSelectedNode";$.ui.dynatree.defaults={title:"Dynatree root",rootVisible:false,rootCollapsible:false,imagePath:null,children:null,initId:null,initAjax:null,onSelect:null,onUnselect:null,onLazyRead:null,onFocus:null,onBlur:null,focusRoot:true,keyboard:true,autoCollapse:false,expandOnAdd:false,selectExpandsFolders:true,selectionVisible:true,idPrefix:'ui-dynatree-id-',ajaxDefaults:{cache:false,dataType:"json"},strings:{loading:"Loading&#8230;",loadError:"Load error!"},classnames:{container:"ui-dynatree-container",expander:"ui-dynatree-expander",hidden:"ui-dynatree-hidden",disabled:"ui-dynatree-disabled",selected:"ui-dynatree-selected",folder:"ui-dynatree-folder",document:"ui-dynatree-document",focused:"ui-dynatree-focused",loading:"ui-dynatree-loading"},debugLevel:0,persist:false,cookieId:"ui-dynatree-cookie",lastentry:undefined};$.ui.dynatree.nodedatadefaults={title:null,key:null,isFolder:false,isLazy:false,expand:false,tooltip:null,icon:null,children:null,lastentry:undefined};})(jQuery);